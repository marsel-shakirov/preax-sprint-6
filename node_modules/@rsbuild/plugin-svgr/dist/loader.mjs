import * as __WEBPACK_EXTERNAL_MODULE_node_path_c5b9b54f__ from "node:path";
import * as __WEBPACK_EXTERNAL_MODULE_node_util_1b29d436__ from "node:util";
import * as __WEBPACK_EXTERNAL_MODULE__svgr_core_4799aff5__ from "@svgr/core";
import * as __WEBPACK_EXTERNAL_MODULE__svgr_plugin_jsx_dba1ddfc__ from "@svgr/plugin-jsx";
import * as __WEBPACK_EXTERNAL_MODULE__svgr_plugin_svgo_bbb5d7de__ from "@svgr/plugin-svgo";
const transformSvg = (0, __WEBPACK_EXTERNAL_MODULE_node_util_1b29d436__.callbackify)(async (contents, config, state)=>(0, __WEBPACK_EXTERNAL_MODULE__svgr_core_4799aff5__.transform)(contents, config, state));
function svgrLoader(contents) {
    this?.cacheable();
    const callback = this.async();
    const options = this.getOptions();
    const previousExport = (()=>{
        if (contents.startsWith('export ')) return contents;
        const exportMatches = contents.match(/^module.exports\s*=\s*(.*)/);
        return exportMatches ? `export default ${exportMatches[1]}` : null;
    })();
    const state = {
        caller: {
            name: '@rsbuild/plugin-svgr',
            previousExport,
            defaultPlugins: [
                __WEBPACK_EXTERNAL_MODULE__svgr_plugin_svgo_bbb5d7de__["default"],
                __WEBPACK_EXTERNAL_MODULE__svgr_plugin_jsx_dba1ddfc__["default"]
            ]
        },
        filePath: (0, __WEBPACK_EXTERNAL_MODULE_node_path_c5b9b54f__.normalize)(this.resourcePath)
    };
    if (previousExport) this.fs.readFile(this.resourcePath, (err, result)=>{
        if (err) {
            callback(err);
            return;
        }
        transformSvg(String(result), options, state, (err, content)=>{
            if (err) {
                callback(err);
                return;
            }
            callback(null, content);
        });
    });
    else transformSvg(contents, options, state, callback);
}
const loader_rslib_entry_ = svgrLoader;
export { loader_rslib_entry_ as default };
